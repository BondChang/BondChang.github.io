
<!DOCTYPE html>
<html>
<head lang="en">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<title>一起杀鬼子吧！</title>
<link href="css/gun_second.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="js/zepto.min.js"></script>
<script type="text/javascript" src="js/touch.js"></script>
<script>
    $(function(){
        var shareData = {
            title: "做个弹无虚发的神枪手有多难？",
            desc: "身为神枪手，必须枪枪命中！来比比40秒内谁击倒的敌人最多吧！",
            img: "img/240.jpg",//分享图片
            link: "index.html"
        }


        /*$('.lookjlw').on("tap",function(){
            shareQQNews();
        });*/

        var UA = function(){
            var userAgent = navigator.userAgent.toLowerCase();
            return {
                ipad: /ipad/.test(userAgent),
                iphone: /iphone/.test(userAgent),
                android: /android/.test(userAgent),
                qqnews: /qqnews/.test(userAgent),
                weixin: /micromessenger/.test(userAgent),
                qqnews_version: userAgent.match(/qqnews/i) == "qqnews" ? userAgent.split('qqnews/')[1] : ''
            };
        };


        function shareQQNews() {
            var ua = UA();
            switch(true){
                case ua.qqnews:
                    if(window.TencentNews && window.TencentNews.setShareArticleInfo){
                        window.TencentNews.setShareArticleInfo(shareData.title, shareData.desc, shareData.desc, shareData.link, shareData.img);
                    }
                    if(window.TencentNews && window.TencentNews.showShareMenu) {
                        window.TencentNews.showShareMenu(shareData.link, shareData.title, shareData.desc, shareData.img,"news_news_wc");
                    }else{
                        window.TencentNews.shareFromWebView(shareData.title, shareData.desc, shareData.img);
                    }
                    break;
                case ua.weixin:
                    var weixinLayout=document.querySelector(".weixin_layout");
                    weixinLayout.style.display="block";
                    weixinLayout.addEventListener("click",function(){
                        weixinLayout.style.display="none";
                    });
                    break;
                default:
                    window.location = "http://share.v.t.qq.com/index.php?c=share&a=index&appkey=801378464&url="
                            + shareData.link + "&title="
                            + shareData.desc +"&pic="
                            + shareData.img + "&des="
                            + shareData.title;
                    break;
            };
        }

        function onBridgeReady() {

            //转发朋友圈
            WeixinJSBridge.on("menu:share:timeline", function(e) {
                var data = {
                    img_width: "120",
                    img_height: "120",
                    img_url: shareData.img,
                    link: shareData.link,   //desc这个属性要加上，虽然不会显示，但是不加暂时会导致无法转发至朋友圈，
                    desc: shareData.title,
                    title: shareData.desc
                };
                WeixinJSBridge.invoke("shareTimeline", data, function(res) {
                    WeixinJSBridge.log(res.err_msg)
                });
            });
            //同步到微博
            WeixinJSBridge.on("menu:share:weibo", function() {
                WeixinJSBridge.invoke("shareWeibo", {
                    "content": shareData.desc,
                    "url": shareData.link
                }, function(res) {
                    WeixinJSBridge.log(res.err_msg);
                });
            });
            //分享给朋友
            WeixinJSBridge.on('menu:share:appmessage', function(argv) {
                WeixinJSBridge.invoke("sendAppMessage", {
                    img_width: "120",
                    img_height: "120",
                    img_url: shareData.img,
                    link: shareData.link,
                    desc: shareData.desc,
                    title: shareData.title
                }, function(res) {
                    WeixinJSBridge.log(res.err_msg)
                });
            });
        };
        //执行
        document.addEventListener('WeixinJSBridgeReady', function() {
            onBridgeReady();
        });

        function androidQQNewsShare(){
            var fileref=document.createElement('script')//创建标签
            fileref.setAttribute("type","text/javascript")//定义属性type的值为text/javascript
            fileref.setAttribute("src", "http://mat1.gtimg.com/www/js/newsapp/jsapi/news.js?_tsid=1")//文件的地址
        }
        androidQQNewsShare();






        //图片预加载
        function loadImg(picArr, callback){
            var index = 0;
            var len = picArr.length;
            function loads(){
                var img = new Image();
                img.src = picArr[index];
                img.onload = function() {
                    if (index < len) {
                        loads();
                        var percent = Math.round(((index+1)/len)*100);
                        $('.zidan').css({'width':percent+'%'});
                        $('.line_go').find('span').css({'width':percent+'%'});
                        $('.percent').html(percent+'%');

                    }else{
                        callback&&callback();
                    }
                    index++;
                }
                return img;
            }

            if(len > 0){
                loads();
            }
        }
        var pics = [
            'img/alld_0.png',
            'img/alld_1.png',
            'img/alld_2.png',
            'img/copyright.png',
            'img/dzd.png',
            'img/fx_03.png',
            'img/fx_07.png',
            'img/fx_09.png',
            'img/gameing0.png',
            'img/gameing2.jpg',
            'img/gun.png',
            'img/hanjian.png',
            'img/jiangjun_03.png',
            'img/loadbg.jpg',
            'img/mdz_16.png',
            'img/nodz.png',
            'img/nostart.png',
            'img/plan.png',
            'img/pp_0.png',
            'img/pp_1.jpg',
            'img/pp_2.jpg',
            'img/pp_3.jpg',
            'img/sh_07.png',
            'img/sh_08.png',
            'img/sh_14.png',
            'img/sh_16.png',
            'img/sh_18.png',
            'img/shibing_03.png',
            'img/start_03.png',
            'img/start_07.png',
            'img/start_11.png',
            'img/zidan.png',
            'img/jj1.png',
            'img/jj2.png',
            'img/jj3.png',
            'img/jj4.png',
            'img/hj1.png',
            'img/hj2.png',
            'img/hj3.png',
            'img/hj4.png',
            'img/sb1.png',
            'img/sb2.png',
            'img/sb3.png',
            'img/sb4.png',
            'img/cover_02.png',
            'img/gm_03.png',
            'img/gmz_11.png'
        ];

        var oLoading=$("#loading");
        var start = $(".start");


        var onePic=0;
        var onePTm=null;

        loadImg(pics, function(){
            start.show();
            oLoading.addClass('fadeOut');
            start.addClass('fadeIn');
            if(oLoading.attr('class')){
                setTimeout(function(){
                    oLoading.hide();
                    oLoading.removeClass();
                }, 600);
            }


            $(".start_zd").addClass('bkgrps');
            onePTm=setInterval(function(){
                onePic++;
                $('.singlejjs').html('<img src="img/jj'+onePic+'.png" />');
                $('.singlehjs').html('<img src="img/hj'+onePic+'.png" />');
                $('.singlesbs').html('<img src="img/sb'+onePic+'.png" />');
                if(onePic>3){
                    onePic=0;
                }
            }, 120)



        });
        var winW = $(window).width(), winH = $(window).height();
        var gameing=$(".gameing");
        var plan=$(".plan");
        var niuNum,objCircleX0,objCircleX1,objCircleX2;
        var runPtimer0=runPtimer1=runPtimer2=null;
        var hj=$(".hanjian"),jj=$(".jiangjun"),sb=$(".shibing");
        var objArr=[hj,jj,sb];

        $(".start_game").on('tap', function(){
            clearInterval(onePTm);
            $(".start_zd").removeClass('bkgrps');

            var runI=0;
            var runTimer=null;
            var shibing = $(".shibing").find('i');
            var hanjian = $(".hanjian").find('i');
            var jiangjun = $(".jiangjun").find('i');
            clearInterval(runTimer);
            runTimer=setInterval(function(){
                runI++;
                shibing.removeClass().addClass('anim' + runI);
                hanjian.removeClass().addClass('anim' + runI);
                jiangjun.removeClass().addClass('anim' + runI);
                if(runI==4){
                    runI=0;
                    shibing.removeClass().addClass('anim0');
                    hanjian.removeClass().addClass('anim0');
                    jiangjun.removeClass().addClass('anim0');
                }
            }, 120);

            plan.addClass('move');
            start.removeClass('fadeIn').addClass('fadeOut');
            gameing.addClass("fadeIn");
            setTimeout(function(){
                start.hide();
                start.removeClass('fadeOut');
            }, 600);

            for(var i=0; i<objArr.length; i++){
                objArr[i].css({left:winW});
            }

            runPtimer0=setInterval(function(){

                var random=runPeople();
                var leftP=0;
                if(random==0){
                    leftP=-100;
                }else if(random==1){
                    leftP=-120;
                }else if(random==2){
                    leftP=-132;
                }
                runPerson(objArr[random],random,leftP);

            },1200);



            oneMinDjs();

        });

        //一分钟倒计时
        var maxtime, EndTime;
        var oneMin=null;
        var oSeconds=$(".gunnum").find('div').find('span');
        function CountDown(EndTime){
            var nMS = EndTime - new Date().getTime();
            var nS = Math.floor(nMS / 1000) % 60-20;
            if(nS<10){
                nS='0'+nS;
            }
            if(nS=='00'){
                clearInterval(oneMin);



                clearInterval(runPtimer0);
                setTimeout(function(){
                    oGun.hide();
                },450);
                setTimeout(function(){

                    sharepage.show();
                    sharepage.addClass('fadeIn');
                    setTimeout(function(){
                        sharepage.removeClass('fadeIn');
                    }, 600);

                    starFn();

                    $(".lookjlw").bind('click', function(){
                        $(".wxshare").show();
                    });
                    $(".wxshare").bind('click', function(){
                        $(".wxshare").hide();
                    });


                }, 1500);

                oSeconds.html('00');


            }else{
                oSeconds.html(nS);
            }
        }
        //一分钟倒计时执行
        function oneMinDjs(){
            maxtime =1000 * 60 * 60 * 24 * 2;
            EndTime = new Date().getTime() + maxtime;
            oneMin=setInterval(function(){
                CountDown(EndTime);
            }, 1000);
        }






        var peopleArr=[0,1,2];
        function runPeople(){
            peopleArr.sort(function(){
                return Math.random()-0.5
            });
            niuNum=peopleArr.splice(0,1)[0];
            if(peopleArr.length==0){
                peopleArr=[0,1,2];
            }
            return niuNum;
        }

        function runPerson(obj,ppX,leftInt){

            move(obj[0],{left:leftInt},{ming:function(){

                var psX=Math.floor((obj.offset().left)+((obj.offset().width)/2));

                if(ppX==0){
                    objCircleX0 = psX;
                }else if(ppX==1){
                    objCircleX1 = psX;
                }else if(ppX==2){
                    objCircleX2 = psX;
                }

            }},{duration:2000, complete:function(){
                obj.css({left:winW});
                if(obj.css('display')=='none'){
                    obj.css({left:winW,display:'block'});
                }
            }});
        }

        var flag=true;
        var oGun=$(".first");

        var sheji=$(".sheji");
        var shejino=$(".shejino");
        var gunLeft = oGun.offset().left,gunWidth = oGun.offset().width,circleX = parseInt(gunLeft+gunWidth/2);
        var runI2=runIn2=0;
        var runTimer2=runTimern2=null;
        var zdmove = $(".sheji").find('i');
        var zdmoven = $(".shejino").find('i');

        oGun.on('tap',function(){
            if(flag){
                clickGun();
            }


        });

        function shejiBg(){
            flag=false;
            sheji.show();
            clearInterval(runTimer2);
            runTimer2=setInterval(function(){
                runI2++;
                zdmove.removeClass().addClass('anim' + runI2);
                if(runI2==6){
                    runI2=0;
                    zdmove.removeClass().addClass('anim0');
                }
            }, 70);

            setTimeout(function(){
                clearInterval(runTimer2);
                runI2=0;
                zdmove.removeClass().addClass('anim0');
                sheji.hide();

                flag=true;
            }, 420);
        }

        function shejiBgno(){
            flag=false;
            shejino.show();
            clearInterval(runTimern2);
            runTimern2=setInterval(function(){
                runIn2++;
                zdmoven.removeClass().addClass('anim' + runIn2);
                if(runIn2==3){
                    runIn2=0;
                    zdmoven.removeClass().addClass('anim0');
                }
            }, 70);

            setTimeout(function(){
                clearInterval(runTimern2);
                runIn2=0;
                zdmoven.removeClass().addClass('anim0');
                shejino.hide();
                flag=true;
            }, 210);
        }


        var sum=hjNum=jjNum=sbNum=0;
        var sharepage = $(".sharepage");
        function clickGun(){

            shejiBgno();

            if((circleX-objCircleX0)>-30&&(circleX-objCircleX0)<5){
                shejiBg();
                hjNum++;
                $(".pp_biaozhi>div").eq(1).find('h3').html('×'+hjNum);
                hj.addClass('fadeOutFast');
                setTimeout(function(){
                    hj.hide();
                    hj.removeClass('fadeOutFast');
                }, 400);

            }


            if((circleX-objCircleX1)>-30&&(circleX-objCircleX1)<5){
                shejiBg();
                jjNum++;
                $(".pp_biaozhi>div").eq(0).find('h3').html('×'+jjNum);
                jj.addClass('fadeOutFast');
                setTimeout(function(){
                    jj.hide();
                    jj.removeClass('fadeOutFast');
                }, 400);
            }

            if((circleX-objCircleX2)>-30&&(circleX-objCircleX2)<5){
                shejiBg();
                sbNum++;
                $(".pp_biaozhi>div").eq(2).find('h3').html('×'+sbNum);
                sb.addClass('fadeOutFast');
                setTimeout(function(){
                    sb.hide();
                    sb.removeClass('fadeOutFast');
                }, 400);
            }

        }

        $(".replaygame").on('tap',function(){
            oSeconds.html('39');
            oneMinDjs();
            clearInterval(runPtimer0);
            oGun.show();
            sharepage.addClass('fadeOut');
            setTimeout(function(){
                sharepage.removeClass('fadeOut');
                sharepage.hide();
            }, 600);

            sum=hjNum=jjNum=sbNum=0;

            $(".people").find('div').show();
            $(".pp_biaozhi div").find('h3').html('×0');

            runPtimer0=setInterval(function(){

                var random=runPeople();

                var leftP=0;
                if(random==0){
                    leftP=-100;
                }else if(random==1){
                    leftP=-120;
                }else if(random==2){
                    leftP=-132;
                }
                runPerson(objArr[random],random,leftP);

            },1200);

        });


        var total=0;
        function starFn(){
            var dzDiv=$(".dazhong>div");
            dzDiv.eq(0).find('h3').html('×'+jjNum);
            dzDiv.eq(1).find('h3').html('×'+hjNum);
            dzDiv.eq(2).find('h3').html('×'+sbNum);

            sum=jjNum*4+hjNum*3+sbNum*2;
            total=jjNum+hjNum+sbNum;
            console.log(sum);
            if(sum>=60){
                sum=60;
            }

            if(sum==0){
                $(".fx_word").html("一共击毙了<span>"+total+"</span>个敌人，开枪按钮，真的是用来开枪的。再试试看吧？");
                shareData.title="身为神枪手，必须枪枪命中！40秒内你能击倒多少个敌人？";
                shareData.desc='我击毙了'+total+'个敌人，谁敢跟我比枪法！';
            }else if(sum>0&&sum<=10){
                $(".fx_word").html("一共击毙了<span>"+total+"</span>个敌人，同志，你拿着枪是当摆设吗？");
                shareData.title="身为神枪手，必须枪枪命中！40秒内你能击倒多少个敌人？";
                shareData.desc='我击毙了'+total+'个敌人，谁敢跟我比枪法！';
            }else if(sum>=11&&sum<=20){
                $(".fx_word").html("一共击毙了<span>"+total+"</span>个敌人，悄悄告诉你，把握好开枪时机才是命中的关键！");
                shareData.title="身为神枪手，必须枪枪命中！40秒内你能击倒多少个敌人？";
                shareData.desc='我击毙了'+total+'个敌人，谁敢跟我比枪法！';
            }else if(sum>=21&&sum<=30){
                $(".fx_word").html("一共击毙了<span>"+total+"</span>个敌人，任何一个敌人都别放过，再试一次吧！");
                shareData.title="身为神枪手，必须枪枪命中！40秒内你能击倒多少个敌人？";
                shareData.desc='我击毙了'+total+'个敌人，谁敢跟我比枪法！';
            }else if(sum>=41&&sum<=50){
                $(".fx_word").html("一共击毙了<span>"+total+"</span>个敌人，瞄准啊！不能让任何一个敌人有逃跑的机会！");
                shareData.title="身为神枪手，必须枪枪命中！40秒内你能击倒多少个敌人？";
                shareData.desc='我击毙了'+total+'个敌人，谁敢跟我比枪法！';
            }else if(sum>=51&&sum<=60){
                $(".fx_word").html("一共击毙了<span>"+total+"</span>个敌人，每出手必有人倒下，你就是传说中的神枪手！");
                shareData.title="身为神枪手，必须枪枪命中！40秒内你能击倒多少个敌人？";
                shareData.desc='我击毙了'+total+'个敌人，谁敢跟我比枪法！';
            }

        }



        function move(obj, json, moving, options){
            moving=moving||{};
            options=options||{};
            options.duration = options.duration||1000;


            var dis={};
            var start={};
            for(var name in json){
                start[name]=parseFloat(getStyle(obj,name));
                dis[name]=json[name]-start[name];
            }

            var count=Math.round(options.duration/30);
            var n=0;
            clearInterval(obj.timer);
            obj.timer = setInterval(function(){
                n++;
                for(var name in json){

                    var a=n/count;
                    var cur=start[name]+dis[name]*a;

                    moving.ming && moving.ming();

                    if(name=='opacity'){
                        obj.style.opacity=cur;
                        obj.style.filter='alpha(opacity:'+cur*100+')';
                    }else{
                        obj.style[name]=cur+'px';
                    }
                }

                if(n==count){
                    clearInterval(obj.timer);
                    options.complete&&options.complete();
                }
            }, 30);


        }

        function getStyle(obj, sName){
            if(obj.currentStyle){
                return obj.currentStyle[sName];
            }else{
                return getComputedStyle(obj, false)[sName];
            }
        }



    });
</script>
</head>
<body>

<div class="gameing">
    <div class="run_bg"></div>
    <div class="plan"><img src="img/plan.png" /></div>
    <div class="people">
        <div class="hanjian"><i class="anim0"></i></div>
        <div class="jiangjun"><i class="anim0"></i></div>
        <div class="shibing"><i class="anim0"></i></div>
    </div>
    <div class="xiaocao"></div>
    <div class="first"><div class="sheji" style="display: none;"><i class="anim0"></i></div><div class="shejino" style="display: none;"><i class="anim0"></i></div><img src="img/gun.png" /></div>

    <div class="gunnum">
        <div><span>39</span>"</div>
        <!--<div><img src="img/alld_2.png"></div>
        <div><img src="img/alld_2.png"></div>
        <div><img src="img/alld_2.png"></div>
        <h3>×<span>3</span></h3>-->
    </div>
    <div class="pp_biaozhi">
        <div><p><img src="img/pp_1.jpg"></p><h3>×0</h3></div>
        <div><p><img src="img/pp_3.jpg"></p><h3>×0</h3></div>
        <div><p><img src="img/pp_2.jpg"></p><h3>×0</h3></div>
    </div>
</div>

<div class="sharepage" style="display: none;">
    <div class="result">
        <div class="dazhong clearfix"><div><img src="img/sh_18.png"><h3>×0</h3></div><div><img src="img/sh_16.png"><h3>×0</h3></div><div><img src="img/sh_14.png"><h3>×0</h3></div></div>
        <div class="fx_word">你只剩三发子弹，瞄准敌方大BOSS，开枪！</div>
        <!--<div class="stars"><img src="img/sh_07.png"><img src="img/sh_07.png"><img src="img/sh_08.png"></div>-->
    </div>
    <div class="replay"><img class="replaygame" src="img/fx_07.png" /><a class="showreslut" href="javascript:;"><img class="lookjlw" src="img/zjxy06.png" /></a></div>
</div>

<div class="wxshare" style="display: none;">
    <div class="shareimg"><img src="img/sqsfx_03.png" /></div>
</div>

<div class="start">
    <div class="start_bnr"><img src="img/start_03.png" /></div>
    <div class="start_wd">一大波敌军正在袭来，40秒内你能击倒多少人？争取做个弹无虚发的神枪手！</div>
    <div class="start_zd">
        <!--<div class="hjs"><i class="anim0"></i></div>
        <div class="jjs"><i class="anim0"></i></div>
        <div class="sbs"><i class="anim0"></i></div>-->

        <div class="singlejjs"></div>
        <div class="singlehjs"></div>
        <div class="singlesbs"></div>
    </div>
    <div class="start_game"><img src="img/start_11.png" /></div>
</div>

<div id="loading">
    <div class="jindu">
        <div class="zidan clearfix" style="width: 0%;"><img src="img/zidan.png" /></div>
        <div class="line_go"><span style="width: 0%;"></span></div>
        <div class="percent">0%</div>
    </div>
    <div class="logo"><img src="img/copyright.png" /></div>
</div>

<script language="javascript"src="http://pingjs.qq.com/ping.js"></script>

<script>
(function(){var _href=location.href,_search=location.search.toLowerCase().replace(/adtag=client\.qq\.\d+_\.0/,'from=tips'),arr=['aio','tips'],type='',from='',_arr=[];if(_href.search(/from=/)!==-1){_arr=_href.split('&');for(var j=0,len=_arr.length;j<len;j++){if(_arr[j].indexOf('qqcom_pgv_from=')>-1){from=_arr[j].indexOf('#')>-1?_arr[j].substring(5,_arr[i].indexOf('#')):_arr[j].substring(5)}}}if(window['ARTICLE_INFO']&&ARTICLE_INFO['catalog_full']){for(var i=0,len=arr.length;i<len;i++){if(_search.search(arr[i])!==-1){type=arr[i];addEvent(document,'click',function(e){_formFun(e,type)})}}newPgvDetail()}else{if(typeof(pgvMain)=='function'){if(typeof(whatCatalog)!='undefined'){pvCSTM=whatCatalog}pgvInfo="F."+from||'def';pgvMain({pgUserType:pgvInfo})}}function newPgvDetail(){var catalogPathR1=ARTICLE_INFO.catalog_full.toString().replace(/-/g,".");var catalogPath=catalogPathR1.toString().replace(/_/g,"-");if(ARTICLE_INFO.topic.name.length>0){var L="L.",Z="Z."+catalogPath+"."+ARTICLE_INFO.topic.name}else{var L="L."+catalogPath,Z="Z."}var W="W."+ARTICLE_INFO.type,M="M."+ARTICLE_INFO.tpl.type+ARTICLE_INFO.tpl.stype,P="P."+ARTICLE_INFO.site.toString().replace(/_/g,"-"),F="F."+from||'def',pgvInfo=L+"_"+Z+"_"+W+"_"+M+"_"+P+"_"+F;if(typeof(pgvMain)=='function'){if(typeof(pgvInfo)!='undefined'){pgvMain({pgUserType:pgvInfo})}}}function addEvent(node,type,listener){if(node.addEventListener){node.addEventListener(type,listener,false);return true}else if(node.attachEvent){node['e'+type+listener]=listener;node[type+listener]=function(){node['e'+type+listener](window.event)};node.attachEvent('on'+type,node[type+listener]);return true}return false}function _formFun(e,t){var e=window.event||e,target=e.srcElement||e.target,tag=target.tagName.toLowerCase(),href=target.href,str='',arr=[];if(tag=='img'){target=target.parentNode;tag=target.tagName.toLowerCase();href=target.href}if(href.indexOf('qqcom_pgv_from=')>-1)return;if(tag=='a'&&target.href.indexOf('qq.com')>-1){if(target.href.indexOf('?')==-1){str=href+'?qqcom_pgv_from='+t}else{arr=href.split('?');str=arr[0]+'?qqcom_pgv_from='+t+'&'+arr[1]}target.href=str}}})()</script>

<script src="http://mat1.gtimg.com/v/ptag/ptag_1.1.js" async="true"></script>

</body>
</html>